<!DOCTYPE html>
<html>

<head lang="fr">
    <meta charset="UTF-8">
    <!--Page Title-->
    <title>Hack-Oeil - Les CTFs de Cyrhades</title>
    <!--Meta Keywords and Description-->
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <link rel="shortcut icon" href="./assets/images/favicon.ico" title="Favicon" />
    <link rel="stylesheet" href="./assets/css/style.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="./assets/css/github.min.css">
    <script src="./assets/js/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Vérifie si la fenêtre est dans une iframe
            if (window.self !== window.top) {
                document.querySelectorAll('a').forEach((link) => {
                    link.addEventListener('click', (event) => {
                        const a = event.target.closest('a[href^="http"]');
                        if (a) {
                            event.preventDefault();
                            window.parent.postMessage({
                                type: "open-external",
                                url: a.href
                            }, "*");
                        }
                    });
                });
            }
            // Active la coloration syntaxique :
            if (window.hljs) {
                hljs.highlightAll();
            } else {
                console.error("Highlight.js non chargé !");
            }
        });
    </script>
</head>

<body>

    <div id="wrapper">
        <!--Main Content Area-->
        <main id="content">
            <!--Ctf-->
            <section class="ctf scrollto">
                <article class="row clearfix">
                    <div class="col-1">
                        <div class="section-heading">
                            <h3>Challenge #435</h3>
                            <h2 class="section-title">The pake is a lie</h2>
                            <p>Nous avons réussi à écouter notre cible lorsqu’elle s’est connectée à son serveur
                                distant. Parviendrez-vous à retrouver son mot de passe ? Le flag est
                                <code>FCSC{H}</code> où <code>H</code> est le haché du mot de passe par SHA256.
                                <br /><br />
                                <strong>Note:</strong> Il est inutile de tester tous les hashés possibles sur ce site.
                                <br />
                                <img src="./assets/images/the-pake-is-a-lie.png">
                            </p>
                            <h4>Fichiers à étudier</h4>
                            <p>
                                - the-pake-is-a-lie.py<br />
                                - output.txt
                            </p>
                            <hr>
                            <strong>the-pake-is-a-lie.py</strong>
                            <pre><code class="language-python">import os
import string
from random import randrange
from hashlib import sha256

PASSWORD = os.getenv("PASSWORD", "fake")

class Server:

    def __init__(self, password):
        # Parameters
        self.p = 99126081498110679622117208839946568977975346033127530222404078981480201164078403345496146296949856728918789240336343638617422048283132242454464446291492611584384751501785383357838317732828318093759885347973087134144406693627357857330950504134924555608896346799104280246597972464783116857557440201146239820962614737545356185926303055992966419563962391182588280591946549056511488286585225437441847723071671691983100789423850862625728681245227608953095286385917258671161510940257372122458091056338357381929396029892868891726999599401117716948670950295974901401487901706396092675230119537481992404521806171202857131482218447629266273659693800992655608637431138440796299719773966019160861946691736898018974264372149526585927739463345353811003110493041611686230570445853159167671930184015631656166581888140313132779812582289364648438529584403147703014843916154647757047547530701247017078776589293631650327878203453320557338297607
        self.q = 219417094215275962897891584141934286732289959275399446266197828228881499677887
        self.gen_p = 5
        self.gen_q = 72154714647924720796474763306018150527191193551579074454752226970361323910715225761684479052710319044131664417748053567305559594047843955631623493511776191150761624423057712199333695861546969039213115324133903199540888607688395526099308852693693849968497163766267565896327807964016029443580636143801729508911217765863848341671551118348011046973222684768978887554468357759171837184458551001147236382457538449300832986979798907732863289077628954566687210037771632552199142257829844076857480798150476647417848684957787136264909313143902413998900899314654316452799924876033142970490676851821804729747044276455816438355824263753284809574944174976279150615425997612511094163023294534830728406472125525906164174075985781960904415647895164715282031620157048260175517210288249757399650428148616065918428303867923400176690656556468547499914734843233868999940689417190530787085270228716948016475608585812032578630717685685190825328784
        self.key = int(sha256(password.encode()).digest().hex(), 16)

    def init_DH(self):
        self.x = randrange(2, self.q)
        X = pow(self.gen_q, self.x, self.p)
        Xenc = self._encrypt(X)
        return Xenc

    def _encrypt(self, m):
        return m * pow(self.gen_p, self.key, self.p) % self.p

    def _decrypt(self, c):
        return c * pow(self.gen_p, -self.key, self.p) % self.p

    def complete_DH(self, Y_enc):
        Y = self._decrypt(Y_enc)
        self.K = pow(Y, self.x, self.p)
        self.H = sha256(hex(self.K).encode() + b"Server").digest().hex()
        return self.H
        
    def check_DH(self, your_H):
        return your_H == sha256(hex(self.K).encode() + b"Client").digest().hex()
   
assert len(PASSWORD) == 4
assert all(x in string.ascii_lowercase for x in PASSWORD)

S = Server(PASSWORD)
Xenc = S.init_DH()
print(f"{Xenc = }")

try:
    print("Input your part of the Diffie-Hellman exchange (integer mod p):")
    Y_enc = int(input(">>> "))

    H = S.complete_DH(Y_enc)
    print(f"{H = }")

    print('Input the hash of the shared key concatenated with "Client" (hex format)')
    your_H = input(">>> ")

    if S.check_DH(your_H):
        print("Connection established!")
    else:
        print("Not quite, try again!")
except:
    print("Check your inputs.")
</code></pre>
                            <br />
                            <strong>output.txt</strong>
                            <pre>Xenc = 19460524269501469684380940282404035263353475313570685944699777212278714734233974848616532867976938042391556360448138597452928815967385556209404253936404195331278865945748733691583103481233229973739048062149957215958944755071256292474208675643955038432029107148362075643154731697188203476192416818811805475474850424618204910903885276181033693382352648269079678235759177277207911853342711777657979574476592861894959055793978346494827004441820586113252218266204154732012769528643417011794778849554113853620663572084387325155825471739765022830613504350108584120580421755123376416482883250676048630917915780936724250343400455175393922102390667903435317779694694201051038813069086292000645527387556789454121634247313392246822415341019000805020774276218525198099950909055708841086228189494310403615523629305142137297289569411467841488144672894655471512477575751150978532821174700641398949624570034053598900921113884230462963866530
>>> 84670717381205440016719090853798939852418749646038823712435648781665144674461878466063166092569283277546919853772421423008690176544659974816667496981163582048472771734186856375338199938692385892071921329848173035737798082097050940388245739636034935245388068536162882410878110071666242695027971713211776153590965483658618178623976672289798767865497599628578488556347449529427918783922082152119048313627919960326510868635530829264575197739953531608841678502422411582312533043052417916055931979687498721896870961159953728004205770476809412625065667055305692843846613243187997480887311556221895849073881321743490721175815615271924666478464203749498025199664746342454585100519032431215000822959406154079422638289685952728634178556229042892358538313317485004490629892684268877050700293424487323426716589875776900888155996590033379362982943090598235769506118719008120861616330790103010762602452608987506626094830297346246555325568
H = '0589fc1f04fa4393c82a53ec18668897a9e88b6a2fe3de22bb134eb9f7d27a32'
Input the hash of the shared key concatenated with "Client" (hex format)
>>> 3c0416f06455670bb12c8b2865e09874cd4135e26bebf1f744cfc6aed6fcb53e
Connection established!
</pre>
                        </div>
                    </div>
                </article>

                <article class="row clearfix">
                    <div class="col-1">
                        <div class="section-heading">
                            <h3>FCSC 2024</h3>
                            <h2 class="section-title">Hackropole</h2>
                            <p class="section-subtitle">
                                Lien officiel :
                                <a target="_blank"
                                    href="https://hackropole.fr/fr/challenges/crypto/fcsc2024-crypto-the-pake-is-a-lie/">FCSC
                                    2024 -
                                    The pake is a lie
                                </a>
                                <br />
                                Auteur: Maxime
                            </p>
                        </div>
                    </div>
                </article>

                <article class="row clearfix">
                    <div class="col-1">
                        <div class="section-heading">
                            <h3>Apprentissage</h3>
                            <h2 class="section-title">Documentations et Vidéos</h2>
                            <p class="section-subtitle">
                                Aucune documentation pour le moment
                            </p>
                        </div>
                    </div>
                </article>

                <article class="row clearfix">
                    <div class="col-1">
                        <div class="section-heading">
                            <h3>Aide</h3>
                            <h2 class="section-title">Conseils et indices</h2>
                            <p class="section-subtitle">
                                <a target="_blank"
                                    href="https://discord.com/channels/1175764392307077120/1175764601716092948">Fil sur
                                    le Discord</a>
                            </p>
                        </div>
                    </div>
                </article>
            </section>
            <!--End of Ctf-->
        </main>
        <!--End Main Content Area-->

        <a id="scrollUp" href="#wrapper" style="position: fixed; z-index: 1000;"
            aria-label="Remonter en haut de la page" title="Remonter en tête de site"></a>
    </div>
</body>

</html>